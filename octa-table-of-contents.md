# ОГЛАВЛЕНИЕ

## **ЧАСТЬ I. ОСНОВЫ СИСТЕМЫ**

### **Раздел 1. Введение, цели и концепция**
1.1 Назначение проекта .................................................... 15  
1.2 Цели системы ............................................................ 16  
1.3 Общая концепция работы ................................................. 18  
1.4 Терминология ........................................................... 21  
1.5 Основные сценарии использования ........................................ 24  
1.6 Принципы обмена данными ................................................ 27  
1.7 Аварийные режимы ....................................................... 29  
1.8 Требования к реализации ................................................ 30  
1.9 Исключения из текущей версии ........................................... 32  

### **Раздел 2. Архитектура системы**
2.1 Общая архитектура ...................................................... 34  
2.2 Последовательность инициализации ....................................... 37  
2.3 Токены и идентификация ................................................. 40  
2.4 Каналы связи ........................................................... 42  
2.5 Маршрутизация команд ................................................... 45  
2.6 Управление состоянием .................................................. 48  
2.7 Обработка физических кнопок ............................................ 51  
2.8 Аварийные режимы ....................................................... 54  
2.9 Распределение данных ................................................... 56  
2.10 Отказоустойчивость .................................................... 58  

### **Раздел 3. Конфигуратор стенда**
3.1 Роль конфигуратора ..................................................... 60  
3.2 Хранение и управление .................................................. 62  
3.3 Структура конфигуратора ................................................ 64  
3.4 Загрузка и валидация ................................................... 72  
3.5 Применение конфигурации ................................................ 75  
3.6 Обновление конфигурации ................................................ 77  
3.7 Локальное кэширование .................................................. 79  
3.8 Визуализация на веб-сайте .............................................. 81  
3.9 Версионирование ........................................................ 83  

### **Раздел 4. Протокол команд и JSON**
4.1 Общие принципы протокола ............................................... 85  
4.2 Формат команды шага .................................................... 87  
4.3 Обработка результатов .................................................. 95  
4.4 События физических кнопок .............................................. 98  
4.5 Heartbeat .............................................................. 100  
4.6 Обработка ошибок ....................................................... 102  
4.7 Команды для Core ....................................................... 104  
4.8 Синхронизация данных ................................................... 106  

## **ЧАСТЬ II. КОМПОНЕНТЫ И ПРОЦЕССЫ**

### **Раздел 5. Шаги работы стенда**
5.1 Классификация шагов .................................................... 108  
5.2 Жизненный цикл шага .................................................... 111  
5.3 Служебные шаги (0-9) ................................................... 114  
5.4 Рабочие шаги (10+) ..................................................... 118  
5.5 Управление потоком данных .............................................. 124  
5.6 Обработка повторов ..................................................... 127  
5.7 Примеры полных сценариев ............................................... 130  

### **Раздел 6. Terminal (HMI)**
6.1 Архитектура Terminal ................................................... 134  
6.2 Bluetooth интеграция ................................................... 137  
6.3 Фотофиксация ........................................................... 145  
6.4 Формы ввода данных ..................................................... 150  
6.5 Механизм retry ......................................................... 154  
6.6 Локальное хранение данных .............................................. 157  

### **Раздел 7. Display (TV)**
7.1 Назначение Display ..................................................... 162  
7.2 Layouts (макеты отображения) ........................................... 164  
7.3 Live Bindings (живые привязки) ......................................... 168  
7.4 Визуализация данных .................................................... 172  
7.5 Summary (итоговые экраны) .............................................. 176  
7.6 Обработка ошибок на Display ............................................ 179  

### **Раздел 8. Core (ESP32-P4)**
8.1 Архитектура Core ....................................................... 182  
8.2 State Machine .......................................................... 185  
8.3 Физические кнопки ...................................................... 189  
8.4 Выполнение Actions ..................................................... 194  
8.5 Управление оборудованием ............................................... 198  
8.6 Очередь команд и приоритеты ............................................ 203  

## **ЧАСТЬ III. БЕЗОПАСНОСТЬ И МОНИТОРИНГ**

### **Раздел 9. Аварийные режимы и восстановление**
9.1 Система аварийных режимов .............................................. 208  
9.2 Heartbeat механизм ..................................................... 212  
9.3 Обработка потери связи ................................................. 216  
9.4 Локальное логирование .................................................. 220  
9.5 Каскадные отказы и восстановление ...................................... 224  
9.6 Мониторинг и диагностика ............................................... 228  
9.7 Отчеты и уведомления ................................................... 232  

### **Раздел 10. Примеры сценариев**
10.1 Полный цикл испытания давлением ....................................... 236  
10.2 Обработка retry ....................................................... 245  
10.3 Аварийная ситуация .................................................... 250  
10.4 Потеря и восстановление связи ......................................... 254  
10.5 Сложная последовательность с множественными измерениями ............... 258  

## **ЧАСТЬ IV. РЕАЛИЗАЦИЯ**

### **Раздел 11. Примеры кода**
11.1 Core (ESP32-P4) - основной код ........................................ 264  
     11.1.1 Main.cpp - точка входа ......................................... 264  
     11.1.2 WebSocket обработчик ........................................... 268  
     11.1.3 Обработчик физических кнопок ................................... 272  
11.2 Cloud (Python) - серверная часть ...................................... 276  
     11.2.1 WebSocket сервер ............................................... 276  
     11.2.2 REST API для управления ........................................ 282  
     11.2.3 Обработчик команд и результатов ................................ 287  
     11.2.4 База данных и миграции ......................................... 292  
     11.2.5 Обработчик телеметрии и мониторинг ............................. 297  
     11.2.6 Служба уведомлений ............................................. 301  
11.3 Дополнительные компоненты Core ........................................ 304  
     11.3.1 Modbus Manager для Core ........................................ 304  
     11.3.2 Safety Monitor для Core ........................................ 307  
     11.3.3 Telemetry Task для Core ........................................ 310  

### **Раздел 12. Заключение и перспективы**
12.1 Достигнутые цели ...................................................... 314  
12.2 Технические достижения ................................................ 317  
12.3 Перспективы развития .................................................. 320  
     12.3.1 Краткосрочные улучшения (3-6 месяцев) .......................... 320  
     12.3.2 Среднесрочные планы (6-12 месяцев) ............................. 323  
     12.3.3 Долгосрочная стратегия (12+ месяцев) ........................... 326  
12.4 Рекомендации по внедрению ............................................. 329  
12.5 Ключевые метрики успеха ............................................... 333  
12.6 Заключительные положения .............................................. 336  

## **ПРИЛОЖЕНИЯ**

### **Приложение А. Глоссарий терминов** .................................... 340

### **Приложение Б. JSON схемы**
Б.1 Схема конфигуратора .................................................... 345  
Б.2 Схема команды .......................................................... 350  
Б.3 Схема результата ....................................................... 353  
Б.4 Схема телеметрии ....................................................... 355  

### **Приложение В. Коды ошибок**
В.1 Системные ошибки ....................................................... 358  
В.2 Ошибки оборудования .................................................... 360  
В.3 Ошибки протокола ....................................................... 362  

### **Приложение Г. Диаграммы последовательностей**
Г.1 Инициализация стенда ................................................... 364  
Г.2 Выполнение команды ..................................................... 366  
Г.3 Обработка retry ........................................................ 368  
Г.4 Аварийный режим ........................................................ 370  

### **Приложение Д. Контрольные списки**
Д.1 Checklist развертывания ................................................ 372  
Д.2 Checklist диагностики .................................................. 374  
Д.3 Checklist обслуживания ................................................. 376  

## **АЛФАВИТНЫЙ УКАЗАТЕЛЬ** ................................................. 378

---

**Общий объем документа: 385 страниц**